<!DOCTYPE html>
<html>
    <head>
        <title>Recherche sur le langage et les &eacute;motions</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-audio-keyboard-response.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-psychophysics.js"></script>
        <script src="stimuli.js"></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
    <script>

  	var timeline = [];
  
	var audio = [];
    for (var i=0; i<stimuli.length; i++) {
    	audio.push(stimuli[i].phrase);
    }

	var images = [];
    for (var i=0; i<stimuli.length; i++) {
    	images.push(stimuli[i].image1);
    }
    for (var i=0; i<stimuli.length; i++) {
    	images.push(stimuli[i].image2);
    }
    for (var i=0; i<stimuli.length; i++) {
    	images.push(stimuli[i].bonne_reponse);
    }
    images.push('img/x.png', 'img/crochet.png');

    var instructions = {
        type: 'html-keyboard-response',
        stimulus: 'Instructions'
    }
    timeline.push(instructions);
   
	var phrase = {
  		type: 'audio-keyboard-response',
		stimulus: jsPsych.timelineVariable('phrase'),
 		prompt: '<span style="font-size:40px;">+</span>',
 		choices: jsPsych.NO_KEYS,
 		trial_ends_after_audio: true
	}
	
	var image = {
  		timeline: [
  			{
  				type: 'psychophysics',
				stimuli: [
					{
						obj_type: 'image',
						file: jsPsych.timelineVariable('image1'),
						startX: 500
					},
					{
						obj_type: 'image',
						file: jsPsych.timelineVariable('image2'),
						startX: 750
					},
				],
 				background_color: "FFFFFF",
 				choices: [37, 39],
 				data: {
           			correct_response: 37,
				}, 
				on_finish: function(data) {
        			var bonne_reponse = false;
					if (data.correct_response == data.key_press) {
						bonne_reponse = true;
					}
          		data.accuracy = bonne_reponse;
          		}
			}
        ]
	}	
	
    var retroaction = {
        type: 'psychophysics',
        stimuli: [
        	{
				obj_type: 'image',
				file: "img/x.png",
				startX:200
			},
			{
				obj_type: 'sound',
				file: jsPsych.timelineVariable('phrase'),
				trial_ends_after_audio: true
			},
			{
				obj_type: 'image',
				file: jsPsych.timelineVariable('bonne_reponse'),
				startX: 625
			},
		],
        background_color: "FFFFFF",
        choices: jsPsych.NO_KEYS,
        on_start: function(retroaction) {
            if (jsPsych.data.getLastTrialData().values()[0].accuracy == true) {
                retroaction.stimuli[0].file = "img/crochet.png";
            }
        }
    }

	var procedure = {
		timeline: [phrase, image, retroaction],
		timeline_variables: stimuli
	}
	timeline.push(procedure);
    
    var fin = {
        type: 'html-keyboard-response',
        stimulus: 'Merci!'
    }
    timeline.push(fin);

    jsPsych.init({
        timeline: timeline,
        preload_audio: audio,
        preload_images: images,
        on_finish: function() {
			jsPsych.data.displayData();
		}
    })

    </script>
</html>